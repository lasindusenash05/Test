<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>English Roleplay Chat</title>
  <script defer src="script.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
  <div id="start-page" class="h-screen flex flex-col items-center justify-center">
    <h1 class="text-2xl mb-4">Who am I?</h1>
    <input id="role-input" type="text" placeholder="e.g. doctor, teacher" class="px-4 py-2 border rounded w-64 mb-4" />
    <button id="start-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded">Continue</button>
  </div>

  <div id="chat-page" class="hidden h-screen flex flex-col">
    <div class="flex-1 overflow-y-auto p-4 space-y-2" id="chat-box"></div>
    <div class="p-4 bg-white border-t">
      <div class="flex gap-2">
        <input id="user-input" type="text" class="flex-1 border px-4 py-2 rounded" placeholder="Type your message..." />
        <button id="send-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Send</button>
      </div>
    </div>
  </div>

  <script>
    const GEMINI_API_KEY = 'AIzaSyDusmRAhk1DBxmmzUmUmmOzV78nrs0KQ1U';

    const startBtn = document.getElementById('start-btn');
    const roleInput = document.getElementById('role-input');
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    startBtn.onclick = () => {
      const role = roleInput.value.trim();
      if (!role) return;
      document.getElementById('start-page').classList.add('hidden');
      document.getElementById('chat-page').classList.remove('hidden');
      addMessage('ai', `Let’s do a roleplay. Imagine I am a ${role}. Let’s start chatting.`);
    };

    sendBtn.onclick = async () => {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage('user', text);
      userInput.value = '';
      const aiReply = await fetchGemini(text);
      addMessage('ai', aiReply);
      speak(aiReply);
    };

    function addMessage(sender, text) {
      const bubble = document.createElement('div');
      bubble.className = `max-w-[70%] px-4 py-2 rounded-xl text-white ${
        sender === 'user' ? 'bg-blue-500 self-end' : 'bg-gray-700 self-start'
      }`;
      bubble.textContent = text;
      chatBox.appendChild(bubble);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function fetchGemini(message) {
      const res = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + GEMINI_API_KEY, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: 'user', parts: [{ text: message }] }]
        })
      });
      const data = await res.json();
      return data.candidates?.[0]?.content?.parts?.[0]?.text || '...';
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
